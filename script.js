(()=>{"use strict";let e,t,n,o,i,r=!1;const a=document.body,s=()=>navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}):Promise.reject("getUserMedia unsupported"),d=async()=>{try{const e=await s();e.getTracks().forEach(t=>t.stop())}catch(e){console.warn("Pre-permission camera request failed:",e)}},c=()=>{if(!n){n=document.getElementById("cam-container");n||(n=document.createElement("div"),n.id="cam-container",document.body.appendChild(n))}if(!t){t=document.createElement("video"),t.setAttribute("playsinline",""),t.setAttribute("autoplay",""),t.muted=!0,t.style.cssText="position:fixed;inset:0;object-fit:cover;width:100vw;height:100vh;z-index:10000;background:#000",n.appendChild(t)}n.style.cssText="position:fixed;inset:0;z-index:10000;display:block;";n.setAttribute("aria-hidden","false")},l=()=>{n&&(n.style.display="none",n.setAttribute("aria-hidden","true"))},u=e=>{e&&e.getTracks&&e.getTracks().forEach(e=>{try{e.stop()}catch{}})},p=async()=>{if(r)return;try{c();o=await s(),t.srcObject=o,await t.play(),r=!0;const e=e=>{e.preventDefault(),m()},{passive:!1,once:!0};n.addEventListener("pointerdown",e,{passive:!1,once:!0}),n.addEventListener("touchstart",e,{passive:!1,once:!0}),n.addEventListener("click",e,{passive:!1,once:!0})}catch(e){console.error("Failed to open camera:",e),alert("⚠️ Não foi possível abrir a câmera. Permita o acesso nas configurações.")}},m=()=>{try{if(!t||!t.videoWidth){setTimeout(m,50);return}const e=document.createElement("canvas"),n=t.videoWidth||1080,a=t.videoHeight||1920;e.width=n,e.height=a;const s=e.getContext("2d",{willReadFrequently:!1,alpha:!1});s.drawImage(t,0,0,n,a);const d=e.toDataURL("image/jpeg",.92);i||(i=document.getElementById("spec-pic")),i&&(i.src=d,i.decoding="async",i.loading="eager")}catch(e){console.error("Capture error:",e)}finally{y()}},y=()=>{r=!1,t&&t.pause&&t.pause(),t&&(t.srcObject=null),o&&(u(o),o=null),l()};function f(e){document.querySelectorAll(".word").forEach(t=>t.textContent=e)}function v(){const e=document.querySelectorAll("#word-container .item.word");e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.type||e.textContent.trim();t&&(f(t),p())})});const t=document.getElementById("wordbtn"),n=document.getElementById("wordinput");t&&t.addEventListener("click",()=>{const e=(n.value||"").trim();e&&(f(e),p())}),n&&n.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),t.click())})}window.addEventListener("pageshow",()=>{a&&"1"===a.dataset.autorequest&&d()},{once:!0}),window.addEventListener("DOMContentLoaded",()=>{i=document.getElementById("spec-pic"),v()})})();
